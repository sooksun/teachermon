/**
 * ตัวชี้วัดการเตรียมความพร้อมและพัฒนาอย่างเข้ม (ครูผู้ช่วย)
 * Based on doc_ref6.pdf
 */

// ด้านของตัวชี้วัด
export enum IndicatorAspect {
  PROFESSIONAL = 'PROFESSIONAL', // ด้านวิชาชีพ
  SOCIAL = 'SOCIAL', // ด้านสังคม
  PERSONAL = 'PERSONAL', // ด้านคุณลักษณะส่วนบุคคล
}

export const INDICATOR_ASPECT_LABELS: Record<IndicatorAspect, string> = {
  [IndicatorAspect.PROFESSIONAL]: 'ด้านวิชาชีพ',
  [IndicatorAspect.SOCIAL]: 'ด้านสังคม',
  [IndicatorAspect.PERSONAL]: 'ด้านคุณลักษณะส่วนบุคคล',
};

// โครงสร้างตัวชี้วัดสำหรับทำรายงาน
export interface IndicatorReportStructure {
  aspect: IndicatorAspect;
  aspectLabel: string;
  sections: IndicatorSection[];
  assessmentRounds: number[]; // ครั้งที่ใช้ประเมิน
  totalItems: number;
  minPassCount?: number; // จำนวนข้อขั้นต่ำที่ต้องผ่าน
}

export interface IndicatorSection {
  code: string;
  name: string;
  subSection?: string;
  items: IndicatorItem[];
}

export interface IndicatorItem {
  code: string;
  name: string;
  description: string;
  requirements: string;
}

// =============================================
// โครงสร้างตารางรายงานตามหมวดหมู่
// =============================================

export const INDICATOR_REPORT_STRUCTURE: IndicatorReportStructure[] = [
  // ─────────────────────────────────────────────
  // 1. ด้านวิชาชีพ (10 รายการ) - ประเมินครั้ง 1-4
  // ─────────────────────────────────────────────
  {
    aspect: IndicatorAspect.PROFESSIONAL,
    aspectLabel: 'ด้านวิชาชีพ',
    assessmentRounds: [1, 2, 3, 4],
    totalItems: 10,
    minPassCount: 9, // ครั้งที่ 1-2: ผ่านไม่น้อยกว่า 9 รายการ
    sections: [
      {
        code: 'PRO_1',
        name: 'การจัดการเรียนรู้',
        items: [
          { code: 'PRO_1.1', name: 'การวิเคราะห์หลักสูตร', description: 'การวิเคราะห์หลักสูตร มาตรฐานการเรียนรู้ และตัวชี้วัด', requirements: '• มีการวิเคราะห์หลักสูตร มาตรฐานการเรียนรู้ และตัวชี้วัด\n• มีการจัดทำรายวิชาหรือคำอธิบายรายวิชา\n• มีหน่วยการเรียนรู้ที่ครอบคลุมเนื้อหาของหลักสูตร' },
          { code: 'PRO_1.2', name: 'การออกแบบการจัดการเรียนรู้', description: 'การออกแบบหน่วยการเรียนรู้ให้สอดคล้องกับรายวิชา ผู้เรียน และบริบท', requirements: '• ออกแบบหน่วยการเรียนรู้ให้สอดคล้องกับรายวิชา\n• มีหน่วยการเรียนรู้สอดคล้องกับผู้เรียนและบริบทของสถานศึกษา\n• มีผลวิเคราะห์ผู้เรียนเป็นรายบุคคล' },
          { code: 'PRO_1.3', name: 'การจัดกิจกรรมการเรียนรู้', description: 'การจัดการเรียนรู้โดยใช้รูปแบบ เทคนิค และเน้นกระบวนการ Active Learning', requirements: '• จัดการเรียนรู้โดยใช้รูปแบบ เทคนิค และเน้นกระบวนการ Active Learning\n• จัดการเรียนรู้สอดคล้องกับมาตรฐาน ตัวชี้วัด และจุดประสงค์' },
          { code: 'PRO_1.4', name: 'การเลือกและใช้สื่อ เทคโนโลยี', description: 'การเลือกและใช้สื่อ เทคโนโลยี และแหล่งเรียนรู้ที่สอดคล้องกับกิจกรรม', requirements: '• มีความสามารถในการเลือกและใช้สื่อ เทคโนโลยี และแหล่งเรียนรู้ที่สอดคล้องกับกิจกรรม\n• สื่อที่ใช้ช่วยให้ผู้เรียนเกิดทักษะการคิด' },
          { code: 'PRO_1.5', name: 'การวัดและประเมินผล', description: 'การวัดและประเมินผลด้วยวิธีการที่หลากหลาย เหมาะสม', requirements: '• มีการวัดและประเมินผลด้วยวิธีการที่หลากหลาย เหมาะสม\n• สอดคล้องกับมาตรฐานการเรียนรู้ เพื่อพัฒนาผู้เรียนอย่างต่อเนื่อง' },
          { code: 'PRO_1.6', name: 'การจัดบรรยากาศ', description: 'การจัดบรรยากาศที่ส่งเสริมและพัฒนาผู้เรียน', requirements: '• จัดบรรยากาศที่ส่งเสริมและพัฒนาผู้เรียน ให้เกิดกระบวนการคิด ทักษะชีวิต ทักษะการทำงาน และทักษะด้านสารสนเทศ/เทคโนโลยี' },
          { code: 'PRO_1.7', name: 'การใช้เทคโนโลยีดิจิทัล', description: 'การจัดการเรียนรู้แบบออนไลน์ หรือประยุกต์ใช้สื่อดิจิทัลเพื่อส่งเสริมการเรียนรู้', requirements: '• มีการจัดการเรียนรู้แบบออนไลน์ หรือประยุกต์ใช้สื่อดิจิทัลเพื่อส่งเสริมการเรียนรู้' },
        ],
      },
      {
        code: 'PRO_2',
        name: 'การส่งเสริมสนับสนุน',
        items: [
          { code: 'PRO_2.1', name: 'การจัดทำข้อมูลสารสนเทศ', description: 'การจัดทำข้อมูลสารสนเทศของผู้เรียนและรายวิชา', requirements: '• จัดทำข้อมูลสารสนเทศของผู้เรียนและรายวิชา เพื่อใช้ส่งเสริมสนับสนุนการเรียนรู้และพัฒนาคุณภาพผู้เรียน' },
          { code: 'PRO_2.2', name: 'ระบบดูแลช่วยเหลือผู้เรียน', description: 'การดำเนินการตามระบบดูแลช่วยเหลือผู้เรียน', requirements: '• ดำเนินการตามระบบดูแลช่วยเหลือผู้เรียน โดยใช้ข้อมูลสารสนเทศรายบุคคล\n• ประสานความร่วมมือกับผู้เกี่ยวข้องเพื่อพัฒนาและแก้ปัญหาผู้เรียน' },
          { code: 'PRO_2.3', name: 'กฎหมายและระเบียบปฏิบัติ', description: 'ความรู้ด้านกฎหมาย ระเบียบที่เกี่ยวข้อง (งาน 4 ฝ่าย)', requirements: '• เรียนรู้กฎหมาย ระเบียบที่เกี่ยวข้อง (งาน 4 ฝ่าย: วิชาการ, งบประมาณ, บุคคล, บริหารทั่วไป)\n• เรียนรู้เรื่องการจัดซื้อจัดจ้าง การเงิน พัสดุ และงานสารบรรณ\n• มีความรู้ด้านนโยบายและกฎหมายการศึกษา' },
        ],
      },
    ],
  },

  // ─────────────────────────────────────────────
  // 2. ด้านสังคม (2 รายการ) - ประเมินครั้ง 3-4
  // ─────────────────────────────────────────────
  {
    aspect: IndicatorAspect.SOCIAL,
    aspectLabel: 'ด้านสังคม',
    assessmentRounds: [3, 4],
    totalItems: 2,
    minPassCount: 3, // ตามแบบบันทึกจริง (อาจนับข้อย่อย)
    sections: [
      {
        code: 'SOC',
        name: 'ด้านสังคม',
        items: [
          { code: 'SOC_1', name: 'การเรียนรู้จากกัลยาณมิตร', description: 'การเรียนรู้จากกัลยาณมิตร (Mentor/ครูพี่เลี้ยง)', requirements: '• มีการเรียนรู้จากกัลยาณมิตร (Mentor/ครูพี่เลี้ยง)\n• มีรายงานหรือบันทึกจากการสังเกตการสอนเพื่อนำมาปรับใช้กับตนเอง' },
          { code: 'SOC_2', name: 'การเรียนรู้เป็นเครือข่าย (PLC)', description: 'การเรียนรู้ร่วมกันเป็นเครือข่ายทางวิชาชีพ (PLC)', requirements: '• มีการเรียนรู้ร่วมกันเป็นเครือข่ายทางวิชาชีพ (PLC)\n• มีหลักฐานการเรียนรู้ร่วมกันทางเครือข่ายวิชาชีพ\n• นำผลมาปรับใช้กับการจัดการเรียนการสอนของตนเอง' },
        ],
      },
    ],
  },

  // ─────────────────────────────────────────────
  // 3. ด้านคุณลักษณะส่วนบุคคล (15 รายการ)
  // ─────────────────────────────────────────────
  {
    aspect: IndicatorAspect.PERSONAL,
    aspectLabel: 'ด้านคุณลักษณะส่วนบุคคล',
    assessmentRounds: [1, 2, 3, 4],
    totalItems: 15,
    minPassCount: 7, // ครั้งที่ 1-2: ผ่านไม่น้อยกว่า 7 รายการ (เฉพาะส่วนวินัยฯ)
    sections: [
      {
        code: 'PER_1',
        name: 'วินัย คุณธรรม จริยธรรม',
        subSection: 'วินัยและการประพฤติตน',
        items: [
          { code: 'PER_1.1', name: 'มีวินัยในตนเอง', description: 'มีวินัยในตนเอง ยอมรับและปฏิบัติตามกฎ กติกา มารยาท ขนบธรรมเนียม', requirements: '• มีวินัยในตนเอง ยอมรับและปฏิบัติตามกฎ กติกา มารยาท ขนบธรรมเนียม' },
          { code: 'PER_1.2', name: 'ตรงต่อเวลา', description: 'ตรงต่อเวลา', requirements: '• ตรงต่อเวลา' },
          { code: 'PER_1.3', name: 'อุทิศเวลาให้แก่ทางราชการและผู้เรียน', description: 'อุทิศเวลาให้แก่ทางราชการและผู้เรียนอย่างต่อเนื่อง', requirements: '• อุทิศเวลาให้แก่ทางราชการและผู้เรียนอย่างต่อเนื่อง' },
          { code: 'PER_1.4', name: 'เอาใจใส่ช่วยเหลือผู้เรียน', description: 'เอาใจใส่ช่วยเหลือผู้เรียน/ผู้รับบริการ เต็มความสามารถ สม่ำเสมอ และเท่าเทียมกัน', requirements: '• เอาใจใส่ช่วยเหลือผู้เรียน/ผู้รับบริการ เต็มความสามารถ สม่ำเสมอ และเท่าเทียมกัน' },
          { code: 'PER_1.5', name: 'รักษาความสามัคคี', description: 'รักษาความสามัคคี มีน้ำใจเอื้อเฟื้อเผื่อแผ่ต่อเพื่อนร่วมงาน', requirements: '• รักษาความสามัคคี มีน้ำใจเอื้อเฟื้อเผื่อแผ่ต่อเพื่อนร่วมงาน' },
        ],
      },
      {
        code: 'PER_1',
        name: 'วินัย คุณธรรม จริยธรรม',
        subSection: 'การเสียสละและแบบอย่าง',
        items: [
          { code: 'PER_1.6', name: 'ช่วยเหลือ/ร่วมมือแก่ส่วนรวม', description: 'ช่วยเหลือ/ร่วมมือแก่ส่วนรวมอย่างทุ่มเท เสียสละจนสำเร็จเกิดประโยชน์', requirements: '• ช่วยเหลือ/ร่วมมือแก่ส่วนรวมอย่างทุ่มเท เสียสละจนสำเร็จเกิดประโยชน์' },
          { code: 'PER_1.7', name: 'มีส่วนร่วมอนุรักษ์วัฒนธรรมไทยและสิ่งแวดล้อม', description: 'มีส่วนร่วมอนุรักษ์วัฒนธรรมไทยและสิ่งแวดล้อม (อย่างน้อย 2 กิจกรรม)', requirements: '• มีส่วนร่วมอนุรักษ์วัฒนธรรมไทยและสิ่งแวดล้อม (อย่างน้อย 2 กิจกรรม)' },
          { code: 'PER_1.8', name: 'ดำรงชีวิตตามหลักปรัชญาของเศรษฐกิจพอเพียง', description: 'ดำรงชีวิตตามหลักปรัชญาของเศรษฐกิจพอเพียง', requirements: '• ดำรงชีวิตตามหลักปรัชญาของเศรษฐกิจพอเพียง' },
          { code: 'PER_1.9', name: 'ละเว้นอบายมุขและสิ่งเสพติด', description: 'ละเว้นอบายมุขและสิ่งเสพติด รวมถึงร่วมรณรงค์ส่งเสริมผู้อื่น', requirements: '• ละเว้นอบายมุขและสิ่งเสพติด รวมถึงร่วมรณรงค์ส่งเสริมผู้อื่น' },
          { code: 'PER_1.10', name: 'ประพฤติตนเป็นแบบอย่างที่ดี', description: 'ประพฤติตนเป็นแบบอย่างที่ดีให้กับผู้เรียน', requirements: '• ประพฤติตนเป็นแบบอย่างที่ดีให้กับผู้เรียน' },
          { code: 'PER_1.11', name: 'รักษาชื่อเสียง ปกป้องศักดิ์ศรีวิชาชีพ', description: 'รักษาชื่อเสียง ปกป้องศักดิ์ศรีวิชาชีพจนได้รับการยกย่อง (อย่างน้อย 1 รายการ)', requirements: '• รักษาชื่อเสียง ปกป้องศักดิ์ศรีวิชาชีพจนได้รับการยกย่อง (อย่างน้อย 1 รายการ)' },
        ],
      },
      {
        code: 'PER_2',
        name: 'การพัฒนาตนเอง',
        items: [
          { code: 'PER_2.1', name: 'ภาษาไทยและอังกฤษ', description: 'การพัฒนาทักษะการใช้ภาษาไทยและภาษาอังกฤษ', requirements: '• อบรม/พัฒนาทักษะการใช้ภาษาไทย อย่างน้อย 1 หลักสูตร\n• อบรม/พัฒนาทักษะการใช้ภาษาอังกฤษ อย่างน้อย 1 หลักสูตร' },
          { code: 'PER_2.2', name: 'เทคโนโลยีดิจิทัล', description: 'การพัฒนาทักษะการใช้เทคโนโลยีดิจิทัลเพื่อการศึกษา', requirements: '• เข้ารับการอบรมและพัฒนาทักษะการใช้เทคโนโลยีดิจิทัลเพื่อการศึกษา' },
          { code: 'PER_2.3', name: 'การเงิน', description: 'การพัฒนาด้านการวางแผนการเงินและวินัยทางการเงิน', requirements: '• เข้ารับการพัฒนาด้านการวางแผนการเงินและวินัยทางการเงิน' },
          { code: 'PER_2.4', name: 'สุขภาพ', description: 'การพัฒนาหรือดูแลสุขภาพกายและใจ', requirements: '• เข้ารับการพัฒนาหรือดูแลสุขภาพกายและใจ' },
        ],
      },
    ],
  },
];

// =============================================
// เกณฑ์การผ่านการประเมิน
// =============================================
export interface PassCriteria {
  round: number; // ครั้งที่
  professional: { total: number; minPass: number };
  social: { total: number; minPass: number } | null;
  personal: { total: number; minPass: number };
}

export const PASS_CRITERIA: PassCriteria[] = [
  {
    round: 1,
    professional: { total: 10, minPass: 9 },
    social: null, // ไม่ใช้ในครั้งที่ 1
    personal: { total: 11, minPass: 7 }, // เฉพาะส่วนวินัยฯ
  },
  {
    round: 2,
    professional: { total: 10, minPass: 9 },
    social: null, // ไม่ใช้ในครั้งที่ 2
    personal: { total: 11, minPass: 7 }, // เฉพาะส่วนวินัยฯ
  },
  {
    round: 3,
    professional: { total: 10, minPass: 11 }, // ตามแบบบันทึก (อาจนับข้อย่อย)
    social: { total: 2, minPass: 3 }, // ตามแบบบันทึก (อาจนับข้อย่อย)
    personal: { total: 15, minPass: 11 }, // รวมส่วนพัฒนาตนเอง
  },
  {
    round: 4,
    professional: { total: 10, minPass: 11 },
    social: { total: 2, minPass: 3 },
    personal: { total: 15, minPass: 11 },
  },
];

// Helper function: ตรวจสอบว่าตัวชี้วัดนี้ใช้ในครั้งที่เท่าไหร่
export function isIndicatorUsedInRound(indicatorCode: string, round: number): boolean {
  // ด้านสังคม (SOC) ใช้ครั้งที่ 3-4
  if (indicatorCode.startsWith('SOC')) {
    return round >= 3;
  }
  // การพัฒนาตนเอง (PER_2) ใช้ครั้งที่ 3-4
  if (indicatorCode.startsWith('PER_2')) {
    return round >= 3;
  }
  // อื่นๆ ใช้ทุกครั้ง
  return true;
}

// Helper function: ดึงโครงสร้างตัวชี้วัดตามด้าน
export function getIndicatorsByAspect(aspect: IndicatorAspect): IndicatorReportStructure | undefined {
  return INDICATOR_REPORT_STRUCTURE.find((s) => s.aspect === aspect);
}

// Helper function: นับจำนวนตัวชี้วัดทั้งหมด
export function getTotalIndicatorCount(): { professional: number; social: number; personal: number; total: number } {
  return {
    professional: 10,
    social: 2,
    personal: 15,
    total: 27,
  };
}
